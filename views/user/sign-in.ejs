<%- include('../common/header.ejs') %>
    <link rel="stylesheet" href="../static/css/user/common.css">
    <link rel="stylesheet" href="../static/css/user/signIn.css">

    <div id="user-box">
        <div class="container">
            <div class="row align-items-center justify-content-cente">
                <div class="col-xl-7 col-lg-8 col-sm-10 col-12 user-form-box">
                    <div class="user-content">
                        <div class="user-header">
                            <a href="/" class="user-logo">
                                <h1>File World</h1>
                            </a>
                            <p>Sign In into your pages account</p>
                        </div>
                        <div class="user-body">
                            <div class="form-group">
                                <input type="id" class="form-control user-id" placeholder="ID" required>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-control user-password" placeholder="Password"
                                    required>
                            </div>
                            <div class="form-group">
                                <a href="/user/forgot-password" class="user-forgot-password">Forgot Password</a>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary user-local-btn">Sign In</button>
                            </div>
                            <div class="user-style-line">
                                <h3>Or user With</h3>
                            </div>
                            <ul class="user-socials">
                                <li class="user-google">
                                    <a href="#" title="google">
                                        <i class="fab fa-google-plus-g"></i>
                                        <span>Google+</span>
                                    </a>
                                </li>

                                <li class="user-facebook">
                                    <a href="#" title="Facebook">
                                        <i class="fab fa-facebook-f"></i>
                                        <span>Facebook</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="user-footer">
                            <p>Don't have an account?
                                <a href="/user/sign-up" class="user-register inline-text">Register</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        const loginLocalBtn = document.querySelector('.user-local-btn');
        const loginGoogleBtn = document.querySelector('.user-google-btn');
        const loginFacebookBtn = document.querySelector('.user-facebook-btn');

        function loginValueCheck(userID, userPassword) {
            if (!userID.trim() || !userID) {
                return notification(
                    'warning',
                    'Enter required values',
                    'Please enter your ID.'
                );
            }

            if (!userPassword.trim() || !userPassword) {
                return notification(
                    'warning',
                    'Enter required values',
                    'Please enter your Password.'
                );
            }

            return true;
        }

        function reqDataCheck(reqResult) {
            if (reqResult.code === 200) {
                // 토큰 저장
                localStorage.setItem('token', reqResult.data[0].token);

                window.location.href = '/';
                return notification('success', 'LOGIN SUCCESS', 'login success');
            } else {
                return notification('warning', 'LOGIN FAIL', 'login fail');
            }
        }

        async function reqSignIn() {
            const userID = document.querySelector('.user-id').value;
            const userPassword = document.querySelector('.user-password').value;

            const loginValueResult = loginValueCheck(userID, userPassword);

            if (loginValueResult) {
                const bodyData = {
                    ui_id: userID,
                    ui_password: userPassword,
                };

                const reqResult = await reqAjax('/api/user/sign-in', 'post', bodyData);

                return reqDataCheck(reqResult);
            }
        }

        loginLocalBtn.addEventListener('click', () => reqSignIn());
    </script>
    <%- include('../common/footer.ejs') %>